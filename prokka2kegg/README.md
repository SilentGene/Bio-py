# Prokka2KEGG
This script is used to assign KO entries (K numbers in KEGG annotation) according to UniProtKB ID in the *.gbk file generated by `Prokka`

## Usage

### ~~Step 1: Download and initialize the cross-reference database provided by UniProt~~

```bash
$ wget ftp://ftp.uniprot.org/pub/databases/uniprot/current_release/knowledgebase/idmapping/idmapping.dat.gz
$ gzip -dc idmapping.dat.gz | awk '{if($2=="KO") print ​$1,$3}' OFS="\t" | gzip > idmapping_KO.tab.gz
```
~~You could choose to remove 'idmapping.dat.gz' now.~~

### Note

UniProt has removed K numbers from their cross-reference database since early 2021. Now users have to download the formatted database from this repo ([idmapping_KO.tab.gz](https://github.com/SilentGene/Bio-py/blob/master/prokka2kegg/idmapping_KO.tab.gz)).

### Step 2: Retrieve K numbers according to the UniProtKB IDs of proteins
```bash
$ python3 prokka2kegg.py -i input.gbk -d idmapping_KO.tab.gz -o output.txt
```

*This script will produce a json format database in the same folder of idmapping_KO.tab.gz for reuse, which may speed up the program when running next time.*

## Options

- `-i`: input gbk file generated by Prokka
- `-o`: output file with gene ids and K entries in tab separeted format
- `-d`: formated cross-reference database from the step 1 (or downloaded directly from my repo)

## Require

- Using **Python3**
- Works both on Windows and unix-like systems
- No 3rd party python modules required

## Sample Output：

|          |        |
| -------- | ------ |
| ORF_0001 |        |
| ORF_0002 | K03152 |
| ORF_0003 |        |
| ORF_0004 | K16331 |
| ORF_0005 | K01997 |

## Tips

There is another script `prokka2kegg_batch.py` which could helped you handle many gbk files in a batch mode.

# Chinese Usage 中文使用说明

这个脚本可以帮助你利用`Prokka`注释得到的gbk文件进行KEGG注释，得到每个ORF对应的KO号。

## 使用

### 第一步：下载和初始化Uniprot提供的数据库间对应的查询库
```bash
$ wget ftp://ftp.uniprot.org/pub/databases/uniprot/current_release/knowledgebase/idmapping/idmapping.dat.gz
$ gzip -dc idmapping.dat.gz | awk '{if($2=="KO") print ​$1,$3}' OFS="\t" | gzip > idmapping_KO.tab.gz
```
### 第二步： 通过每个ORF的UniProtKB IDs在数据库中查询对应的KO号
```bash
$ python3 prokka2kegg.py -i input.gbk -d idmapping_KO.tab.gz -o output.txt
```

*脚本会在idmapping_KO.tab.gz所在的文件夹下产生一个json文件来加快下一次调用数据库查询时的速度。*

## 选项

- `-i`: 输入文件，Prokka注释产生的gbk文件
- `-o`: 输出的带有每个ORF ID和其对应KO号的tab分隔的文本文件
- `-d`: 由第一步产生（或直接从我库中下载）的数据库文件

## 要求

- 使用**Python3**
- 在Windows和类unix系统中均可运行
- 无需第三方python模块

## 输出示例：

|          |        |
| -------- | ------ |
| ORF_0001 |        |
| ORF_0002 | K03152 |
| ORF_0003 |        |
| ORF_0004 | K16331 |
| ORF_0005 | K01997 |

## 提示

另外提供一个脚本`prokka2kegg_batch.py`来同时完成多个gbk文件的转换。